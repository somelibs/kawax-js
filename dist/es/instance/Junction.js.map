{"version":3,"file":"Junction.js","names":["_lodash","_interopRequireDefault","require","_react","_propTypes","_component","_reactRouter","_Component","e","__esModule","_typeof","o","Symbol","iterator","constructor","prototype","_classCallCheck","a","n","TypeError","_defineProperties","r","t","length","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","call","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","value","_setPrototypeOf","_defineProperty","i","_toPrimitive","toPrimitive","String","Number","Junction","_React$Component","_this","_len","arguments","args","Array","_key","concat","match","undefined","route","reference","setState","location","_","get","path","basePath","props","screen","providers","renderer","React","createElement","each","Provider","shouldComponentUpdate","nextProps","nextState","state","shouldUpdate","isEqual","getScope","_this$props","routes","scope","getRoutes","_this$props2","draw","renderRoute","uniqueId","fullPath","getFullPath","loadable","component","map","provider","Route","ref","setRef","render","renderWithProviders","renderRoutes","_this2","Switch","renderWrapper","_this$state","layout","Layout","Component","PropTypes","string","object","isRequired","_default","exports"],"sources":["../../../src/instance/Junction.js"],"sourcesContent":["import _ from 'lodash';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport loadable from '@loadable/component';\nimport { Switch, Route } from 'react-router';\nimport Component from '../Component';\n\nclass Junction extends React.Component {\n\n  static propTypes = {\n    scope: PropTypes.string,\n    basePath: PropTypes.string,\n    routes: PropTypes.object.isRequired,\n  };\n\n  static defaultProps = {\n    scope: undefined,\n    basePath: undefined,\n  };\n\n  state = {\n    match: undefined,\n  };\n\n  shouldComponentUpdate(nextProps, nextState) {\n    const { basePath } = this.props;\n    const { match } = this.state;\n    const shouldUpdate = (!_.isEqual(match, nextState.match)\n                          || !_.isEqual(basePath, nextProps.basePath));\n    return shouldUpdate;\n  }\n\n  setRef = (route) => (reference) => {\n    if (reference) {\n      this.setState({\n        route: route,\n        location: _.get(reference, 'props.location'),\n        match: _.get(reference, 'props.computedMatch'),\n      });\n    }\n  };\n\n  renderComponent = () => {};\n\n  getScope() {\n    const { routes, scope } = this.props;\n    return routes.scope(scope);\n  }\n\n  getRoutes() {\n    const { routes, scope } = this.props;\n    return routes.draw(scope);\n  }\n\n  getFullPath = (path) => {\n    const { basePath } = this.props;\n    return basePath ? `/${basePath}${path}` : path;\n  };\n\n  renderWithProviders = (screen, providers) => (props) => {\n    let renderer = React.createElement(screen, props);\n    _.each(providers, (Provider) => {\n      renderer = React.createElement(Provider, props, renderer);\n    });\n    return renderer;\n  };\n\n  renderRoute(route) {\n    const key = `route-${_.uniqueId()}`;\n    const fullPath = this.getFullPath(route.path);\n    const screen = loadable(route.component);\n    if (route.providers) {\n      const providers = _.map(route.providers, (provider) => loadable(provider));\n      return (\n        <Route\n          key={key}\n          path={fullPath}\n          ref={this.setRef(route)}\n          render={this.renderWithProviders(screen, providers)}\n        />\n      );\n    }\n    return <Route key={key} path={fullPath} component={screen} ref={this.setRef(route)} />;\n  }\n\n  renderRoutes() {\n    const routes = this.getRoutes();\n    return (\n      <Switch>\n        {_.map(routes, (route) => this.renderRoute(route))}\n      </Switch>\n    );\n  }\n\n  renderWrapper() {\n    const scope = this.getScope();\n    const routes = this.renderRoutes();\n    const { match, location, route } = this.state;\n    if (scope.layout) {\n      const Layout = loadable(scope.layout);\n      return (<Layout location={location} match={match} route={route}>{routes}</Layout>);\n    }\n    return routes;\n  }\n\n  render() {\n    return this.renderWrapper();\n  }\n\n}\n\nexport default Component(Junction);\n"],"mappings":"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","ignoreList":[]}