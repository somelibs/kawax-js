{"version":3,"file":"CallThrottler.js","names":["_lodash","_interopRequireDefault","require","_uuid","_Smart2","e","__esModule","_typeof","o","Symbol","iterator","constructor","prototype","_readOnlyError","r","TypeError","_classCallCheck","a","n","_defineProperties","t","length","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","_callSuper","_getPrototypeOf","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","apply","_assertThisInitialized","ReferenceError","Boolean","valueOf","call","setPrototypeOf","getPrototypeOf","bind","__proto__","_inherits","create","value","_setPrototypeOf","_defineProperty","i","_toPrimitive","toPrimitive","String","Number","CallThrottler","_Smart","_this","_len","arguments","args","Array","_key","concat","match","payload","JSON","stringify","_","find","stack","item","isEqual","method","instances","push","request","resolver","promise","Promise","resolveCall","id","uuid","clear","remove","set","data","extend","Smart","_default","exports"],"sources":["../../../src/internal/CallThrottler.js"],"sourcesContent":["import _ from 'lodash';\nimport { v4 as uuid } from 'uuid';\nimport Smart from '../Smart';\n\nclass CallThrottler extends Smart {\n\n  stack = [];\n\n  match(call) {\n    const payload = JSON.stringify(call);\n    const match = _.find(this.stack, (item) => (_.isEqual(item.payload, payload)));\n    if (match && call.method === 'GET') {\n      match.instances += 1;\n      return match;\n    }\n    return false;\n  }\n\n  push(request, call) {\n    let resolver;\n    const promise = new Promise((resolveCall) => {\n      resolver = resolveCall;\n    });\n    const id = uuid();\n    const payload = JSON.stringify(call);\n    const match = _.find(this.stack, (item) => (_.isEqual(item.payload, payload)));\n    if (match && call.method === 'GET') {\n      return match.id;\n    }\n    const instances = 1;\n    this.stack.push({ id, promise, request, resolver, payload, instances });\n    return id;\n  }\n\n  clear(id) {\n    const match = _.find(this.stack, (item) => (item.id === id));\n    if (match) {\n      match.resolver(true);\n      if (match.instances === 1) {\n        _.remove(this.stack, (item) => (item.id === id));\n      } else {\n        match.instances -= 1;\n      }\n    }\n  }\n\n  set(id, data) {\n    const match = _.find(this.stack, (item) => (item.id === id));\n    if (match) {\n      _.extend(match, data);\n    }\n  }\n\n  find(id) {\n    const match = _.find(this.stack, (item) => (item.id === id));\n    return match;\n  }\n\n}\n\nexport default CallThrottler;\n"],"mappings":"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","ignoreList":[]}